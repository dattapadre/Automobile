<%- include('navbar.ejs') %>

  <!-- Bootstrap 5 CSS CDN -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    body {
      background-color: #f8f9fa;
    }

    .invoice-box {
      max-width: 800px;
      margin: auto;
      background: #fff;
      padding: 30px;
      border-radius: 8px;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
      color: #212529;
    }

    .invoice-header h2 {
      font-weight: bold;
      color: #343a40;
    }

    .table th {
      background-color: #000 !important;
      color: #fff;
    }

    .total-row td {
      font-weight: bold;
      font-size: 18px;
      background-color: #f8f9fa;
    }

    .thank-you {
      text-align: center;
      margin-top: 30px;
      font-style: italic;
      color: #6c757d;
    }

    @media print {
      .no-print {
        display: none !important;
      }

      body {
        background: white !important;
      }

      .invoice-box {
        box-shadow: none !important;
        border: none !important;
      }
    }
  </style>

  <div class="invoice-box my-4 p-4">
    <div class="invoice-header text-center mb-4">
      <h2>SK Restaurant</h2>
      <p class="mb-0"><strong>Invoice</strong></p>
    </div>

    <div class="row mb-4">
      <div class="col-md-6">
        <p><strong>Date:</strong>
          <%= order.order_date %>
        </p>
      </div>
      <div class="col-md-6 text-md-end">
        <p><strong>Table:</strong>
          <%= order.table_no %>
        </p>
      </div>
    </div>

    <div class="table-responsive">
      <table class="table table-bordered align-middle">
        <thead>
          <tr>
            <th>Item</th>
            <th>Qty</th>
            <th>Price</th>
            <th>Amount</th>
          </tr>
        </thead>
        <tbody>
          <% let total=0; %>
            <% items.forEach(function(item) { let itemTotal=item.quantity * item.menu_price; total +=itemTotal; %>
              <tr>
                <td>
                  <%= item.menu_name %>
                </td>
                <td>
                  <%= item.quantity %>
                </td>
                <td>‚Çπ<%= item.menu_price %>
                </td>
                <td>‚Çπ<%= itemTotal %>
                </td>
              </tr>
              <% }) %>
                <tr class="table-light">
                  <td colspan="3" class="text-end"><strong>Total</strong></td>
                  <td><strong>‚Çπ<%= total %></strong></td>
                </tr>
        </tbody>
      </table>
    </div>

    <p class="thank-you">Thank you for dining with us! Visit again.</p>
    <!-- ... -->
    <div class="text-center no-print mt-4">
      <!-- ‡§¨‡§ü‡§£‡§Æ‡§ß‡•ç‡§Ø‡•á order_id ‡§™‡§æ‡§∏ ‡§ï‡§∞‡§æ -->
      <button 
  class="btn btn-success px-4" 
  id="payBtn" 
  data-orderid="<%= order.order_id %>" 
  onclick="payNow()">Pay Invoice</button>


    </div>

    <div class="text-center no-print mt-4">
      <button class="btn btn-success px-4" onclick="window.print()">üñ®Ô∏è Print Invoice</button>
    </div>
    </div>
    <script>
     // Razorpay integration after clicking Pay Invoice button
function payNow() {
  const orderId = document.getElementById('payBtn').dataset.orderid;
  const totalAmount = document.getElementById('payBtn').dataset.amount; // You need to add this attribute

  const options = {
    key: "rzp_test_GmXyAFAK01Uo7t", // Replace with your Razorpay test/live key
    amount: totalAmount * 100, // in paise
    currency: "INR",
    name: "SK Restaurant",
    description: "Table Order Payment",
    image: "https://yourdomain.com/logo.png", // optional
    handler: function (response) {
      // Payment success callback
      fetch(`/mark_paid/${orderId}`, {
        method: 'POST'
      })
        .then(res => {
          if (res.ok) {
            alert("Payment successful! Order marked as paid.");
            window.print();
          } else {
            alert("Payment done, but failed to update status in DB.");
          }
        })
        .catch(err => {
          console.error(err);
          alert("Payment success, but DB error.");
        });
    },
    prefill: {
      name: "Customer Name",
      email: "customer@example.com",
      contact: "9999999999"
    },
    notes: {
      order_id: orderId
    },
    theme: {
      color: "#3399cc"
    }
  };

  const rzp = new Razorpay(options);
  rzp.open();
}

// Include Razorpay CDN in your HTML before this script:
// <script src="https://checkout.razorpay.com/v1/checkout.js"></script>


</script>

    <%- include('footer.ejs') %>